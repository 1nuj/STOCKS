<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Pattern Analyzer</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="theme-toggle">
        <label for="themeSelect">üé® Select Theme:</label>
        <select id="themeSelect" onchange="changeTheme(this.value)">
            <option value="ocean" selected>üåä Ocean</option>
            <option value="pro-trader">‚ö° Pro Trader</option>
            <option value="sand">üèñÔ∏è Sand</option>
            <option value="forest">üå≤ Forest</option>
            <option value="stone">ü™® Stone</option>
        </select>
    </div>

    <div class="container">
        <h1>Stock Pattern Analyzer</h1>

        <!-- Drag & Drop Area -->
        <div id="drop-area" class="drop-area">
            <p id="drop-text">Drag & Drop a stock trend image or <label for="imageInput" class="file-label">browse</label></p>
            <input type="file" id="imageInput" title="Upload an image to analyze" />
            <img id="previewImage" class="preview-image" style="display: none;" />
        </div>

        <!-- Uploaded Image Preview -->
        <img id="uploadedImage" class="uploaded-image" alt="Uploaded stock trend image" />

        <button onclick="analyzeImage()" class="analyze-btn">Analyze</button>

        <!-- Progress Bar -->
        <div id="progress-container" class="progress-container hidden">
            <div id="progress-bar" class="progress-bar"></div>
        </div>

        <div id="result-container" class="result-card hidden">
            <h3>Analysis Result:</h3>
            <p id="finalDecision" class="final-decision"></p>
            <p id="confidence" class="confidence-text"></p>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const savedTheme = localStorage.getItem("selectedTheme") || "ocean";
            changeTheme(savedTheme);
            document.getElementById("themeSelect").value = savedTheme;

            // Add change event to image input for preview
            document.getElementById("imageInput").addEventListener("change", handleImagePreview);
        });

        function handleImagePreview(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    // Show the uploaded image in the preview area
                    const previewImage = document.getElementById("uploadedImage");
                    previewImage.src = e.target.result;
                    previewImage.style.display = "block"; // Show the image
                }

                reader.readAsDataURL(file);
            }
        }

        function changeTheme(theme) {
            document.body.className = theme;
            localStorage.setItem("selectedTheme", theme);
        }

        function analyzeImage() {
            const input = document.getElementById("imageInput").files[0];
            if (!input) {
                Swal.fire({ icon: 'error', title: 'Oops...', text: 'Please select an image to analyze!' });
                return;
            }

            // Show progress bar and hide the uploaded image (if any)
            document.getElementById("progress-container").classList.remove("hidden");
            document.getElementById("uploadedImage").style.display = "none"; // Hide image during analysis
            updateProgress(0);

            // Simulate progress and analysis
            let progress = 0;
            let interval = setInterval(() => {
                progress += 20;
                if (progress >= 100) {
                    clearInterval(interval);
                    showResults();
                }
                updateProgress(progress);
            }, 300);
        }

        function updateProgress(progress) {
            const progressBar = document.getElementById("progress-bar");
            progressBar.style.width = progress + "%";
        }

        function showResults() {
            document.getElementById("progress-container").classList.add("hidden");

            // Fake results for demo
            const randomDecision = Math.random() > 0.5 ? "BUY" : "SELL";
            const confidence = (Math.random() * 100).toFixed(2);

            let finalText = randomDecision === "BUY" ? "Final Decision: LONG" : "Final Decision: SHORT";
            let finalClass = randomDecision === "BUY" ? "buy-text" : "sell-text";

            document.getElementById("finalDecision").innerText = finalText;
            document.getElementById("finalDecision").className = "final-decision " + finalClass;
            document.getElementById("confidence").innerText = `Confidence: ${confidence}%`;

            document.getElementById("result-container").classList.remove("hidden");
            document.getElementById("result-container").classList.add("slide-in");
        }
    </script>
</body>
</html>
